<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Solicitud de Materiales</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    /* Variables de Color (Mismas que en las vistas anteriores) */
    :root {
        --color-primary: #004d99; /* Azul marino/institucional */
        --color-secondary: #28a745; /* Verde para enviar/√©xito */
        --color-info: #17a2b8; /* Turquesa para a√±adir */
        --color-danger: #dc3545; /* Rojo para eliminar */
        --color-muted: #6c757d; /* Gris para volver */
        --color-background: #eef1f5; /* Fondo claro y suave */
        --color-card: #ffffff; /* Fondo de las cajas */
        --color-text: #333333; /* Texto oscuro */
        --color-border: #cccccc;
    }

    /* Estilos Generales */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--color-background);
        margin: 0;
        padding: 0;
        color: var(--color-text);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
    }

    /* Caja Principal (Card) */
    .box {
        background: var(--color-card);
        padding: 25px;
        width: 100%;
        max-width: 780px; /* Ancho un poco mayor para la tabla */
        margin: 20px 15px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
    }

    /* Encabezados */
    h2 {
        text-align: center;
        margin-bottom: 25px;
        color: var(--color-primary);
        font-size: 1.8em;
        border-bottom: 2px solid var(--color-primary);
        padding-bottom: 10px;
    }
    h3 { 
        text-align: center; 
        margin-top: 30px;
        margin-bottom: 15px;
        color: var(--color-primary);
        font-size: 1.3em;
    }

    /* Labels e Inputs de Formulario */
    label { 
        font-weight: 600; 
        display: block; 
        margin-top: 15px; 
        color: var(--color-text);
    }
    input, select {
        width: 100%;
        padding: 12px;
        font-size: 1em;
        margin-top: 8px;
        margin-bottom: 20px;
        border-radius: 6px;
        border: 1px solid var(--color-border);
        box-sizing: border-box;
        transition: border-color 0.3s;
    }
    input:focus, select:focus {
        border-color: var(--color-primary);
        outline: none;
        box-shadow: 0 0 5px rgba(0, 77, 153, 0.2);
    }
    /* Estilo espec√≠fico para los inputs envueltos por el autocompletado */
    .autocomplete-wrapper input {
        margin-bottom: 0 !important; /* Eliminar el margen inferior para pegarlo a la lista */
    }
    /* A√±adir algo de margen despu√©s del wrapper si es necesario */
    .autocomplete-wrapper + label {
        margin-top: 25px;
    }


    /* Tabla de Materiales */
    table { 
        width: 100%; 
        border-collapse: collapse; 
        margin-top: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Sombra sutil a la tabla */
    }
    th, td { 
        border: 1px solid #e0e0e0; /* Borde m√°s claro */
        padding: 12px; 
        text-align: left; /* Alineaci√≥n a la izquierda para el material */
    }
    th { 
        background: var(--color-primary); 
        color: var(--color-card); 
        text-align: center;
        text-transform: uppercase;
        font-size: 0.9em;
    }
    #tabla tbody tr:nth-child(even) {
        background-color: #f8f8f8; /* Cebra para mejor lectura */
    }
    td input { 
        padding: 8px; 
        font-size: 1em; 
        border: 1px solid #d0d0d0;
        margin: 0;
    }
    #tabla td:nth-child(2) { /* Columna de Cantidad */
        width: 25%;
        text-align: center;
    }

    /* Botones de Acci√≥n */
    .btnAdd, .btnRemove, .btnEnviar, .btnVolver {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 6px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        margin-top: 12px;
        transition: background-color 0.3s, opacity 0.3s;
    }

    .btnAdd { 
        background: var(--color-info); 
        color: white; 
    }
    .btnAdd:hover { background: #138496; }

    .btnRemove { 
        background: var(--color-danger); 
        color: white; 
    }
    .btnRemove:hover { background: #c82333; }

    .btnEnviar { 
        background: var(--color-secondary); 
        color: white; 
        margin-top: 25px; /* Separaci√≥n de los botones de la tabla */
    }
    .btnEnviar:hover { background: #1e7e34; }

    .btnVolver { 
        background: var(--color-muted); 
        color: white; 
    }
    .btnVolver:hover { background: #5a6268; }

    /* Estilos para M√≥viles */
    @media (max-width: 600px) {
        .box {
            margin: 10px;
            padding: 15px;
        }
        h2 {
            font-size: 1.6em;
        }
        th, td {
            padding: 8px;
            font-size: 0.9em;
        }
        td input {
            padding: 6px;
        }
        .btnAdd, .btnRemove, .btnEnviar, .btnVolver {
            font-size: 1em;
            padding: 12px;
        }
    }
    /* Ajustes del autocompletado */
    .autocomplete-wrapper { 
        position: relative;
    }
    .autocomplete-list {
        position: absolute;
        border: 1px solid var(--color-border); 
        background: var(--color-card); 
        list-style: none;
        padding: 0;
        margin: 0; /* Asegurar que no haya margen */
        max-height: 150px;
        overflow-y: auto;
        width: 100%; 
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        border-radius: 0 0 6px 6px; 
        border-top: none; /* Eliminar el borde superior para pegarlo al input */
    }
    .autocomplete-list li {
        padding: 8px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0; /* Borde de separaci√≥n */
    }
    .autocomplete-list li:last-child {
        border-bottom: none; /* ELIMINA LA L√çNEA SOMBREADA/DE SEPARACI√ìN AL FINAL */
    }
    .autocomplete-list li:hover {
        background-color: #f0f0f0;
    }
</style>
</head>
<body>

<div class="box">
    <h2>Solicitud de Materiales üìã</h2>

    <label for="docente">üë®‚Äçüè´ Docente a cargo:</label>
    <select id="docente">
        <option value="">Seleccione un docente</option>
        <option>AAR√ìN EDUARDO SEP√öLVEDA MEDINA</option>
        <option>ALEJANDRO GABRIEL MOENA VALDERRAMA</option>
        <option>BRAYAN PATRICIO DEL VALLE AEDO</option>
        <option>DANIELA FERNANDA MART√çNEZ MART√çNEZ</option>
        <option>EDUARDO ARTURO BAST√çAS GARC√çA</option>
        <option>EL√çAS ANDR√âS POBLETE AVILA</option>
        <option>GERARDO NICOL√ÅS SEP√öLVEDA GUTI√âRREZ</option>
        <option>GIOVANNI ANDR√âS JARA TORRES</option>
        <option>JORGE ANDR√âS P√âREZ MILLAR</option>
        <option>JOSEFA CATALINA LISBOA RIVERA</option>
        <option>JULIO CESAR ALARCON MONTEROS</option>
        <option>MANUEL ALEJANDRO HENRIQUEZ OLIVA</option>
        <option>MARCO ANTONIO ARRIAGADA CASAS</option>
        <option>PEDRO PATRICIO PEDRERO P√âREZ</option>
        <option>RICHARD ANTONIO VALDERRAMA SAN MARTIN</option>
        <option>RICHARD NICOL√ÅS SANTOS MART√çNEZ</option>
        <option>ROBERTO SEBASTIAN CID LIZAMA</option>
        <option>RODRIGO ALEJANDRO CONTRERAS Z√ö√ëIGA</option>
        <option>RODRIGO ALEJANDRO GARRIDO GARRIDO</option>
        <option>ROLANDO EDUARDO ORTEGA FUENTES</option>
        <option>V√çCTOR EDUARDO ZAPATA MYRIK</option>
        <option>OTROS DOCENTES</option>
    </select>

<label for="asignatura">üìö Asignatura:</label>
<div class="autocomplete-wrapper">
    <input type="text" id="asignatura" placeholder="Ej: Instalaciones El√©ctricas II">
</div>
    
    <h3>Materiales Solicitados</h3>

    <table id="tabla">
        <thead>
            <tr>
                <th>Material / Equipo</th>
                <th style="width: 25%;">Cantidad</th>
            </tr>
        </thead>
        <tbody id="tbody">
            <tr>
                <td>
                    <div class="autocomplete-wrapper">
                        <input type="text" placeholder="Ej: Mult√≠metro UT33C">
                    </div>
                </td>
                <td><input type="number" min="1" value="1"></td>
            </tr>
        </tbody>
    </table>

    <button class="btnAdd" onclick="addRow()">‚ûï Agregar Material</button>
    <button class="btnRemove" onclick="removeRow()">‚ûñ Eliminar √öltimo</button>
    
    <button class="btnEnviar" onclick="enviar()">üì§ Enviar Solicitud</button>
    <button class="btnVolver" onclick="location.href='menu.html'">‚Ü©Ô∏è Volver al Men√∫</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* üîó Conexi√≥n a Supabase */
// NOTA: Estas claves son de ejemplo o est√°n ofuscadas. Aseg√∫rate de que las tuyas sean correctas si las cambiaste.
const SUPABASE_URL = "https://jwcgiuhdugjunndfpdjr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3Y2dpdWhkdWdqdW5uZGZwZGpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NTA2NTQsImV4cCI6MjA3ODUyNjY1NH0.llknOTpK1hFMDOjdyDUKUFuiyr0NwwJzNv6YdJbBsRY";
const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const user = JSON.parse(localStorage.getItem("currentUser"));
if (!user) window.location.href = "index.html";

/* üåü LISTA DE MATERIALES */
const materialesLista = [
"Alargador","Alcohol isoprop√≠lico","Alicate Cortante","Alicate - Punta","Alicate - Universal",
"Amarras pl√°sticas","Analizador de calidad energ√≠a el√©ctrica MI2392","Analizador de calidad energ√≠a el√©ctrica MI2492",
"Ampolleta E27","Amperimetro de tenaza","Antiparras","Arduino UNO","Arduino UNO - Sensores Varios",
"Bateria de 9v","Broca Metal","Broca madera","Brochas","Caja Chuqui","Caja de derivaci√≥n","Caja EMT","Caja de herramientas",
"Calibrador de Corriente - Lazos Novus DC80L","Calibrador de corriente - Victor 05","Calibrador de procesos Fluke 725",
"Calibrador de presi√≥n Fluke 717 500g","Calibrador de presi√≥n manual SIKA P40.2","Calibrador de RTD Novus DC80R",
"Calibrador de termocupla Novus DC80T","Camara termografica Fluke Tis45","Cables Jumper","Cable 1,5mm","Cable 2,5mm",
"Cable de impresora","Cable de poder","Cable de RED industrial Verde","Cable HDMI","Cimpreadora Cables de red",
"Circuitos Integrados - Varios","Casco de seguridad el√©ctrico","Caut√≠n","Certificado de instalaciones Fluke 1664FC",
"Certificador de redes LAN Fluke DTX1800","Certificador de redes LAN Metrel","Cinta Aislante","Cinta auto fundente de goma",
"Condensador Cer√°mico - Varios","Condensador Electrol√≠tico - Varios","Cosenofimetro - Pinza de potencia Hioki 3286-20",
"Crisol esta√±o","Desatornillador de Cruz","Desatornillador de Paleta","Diodos - Varios","ESP32","Enchufe Simple",
"Enchufe Triple","Esmeril Angular","Etiquetador Brother","Equipo soldadura puesta a tierra","Filamento 3D","Ferrules",
"Ferrulera","Fuente de poder Riel din","Frecuenc√≠metro","Fusionadora Fibra √ìptica","Gas Butano","Ge√≥logo Institucional",
"Guantes","Goni√≥metro","Horno Pozo Seco","Interruptor 9/12","Interruptor 9/15","Interruptor 9/24","Interruptor 9/32",
"Interruptor autom√°tico","Interruptor autom√°tico trif√°sico","Interruptor Diferencial","Interruptor Saime","Juego Llaves Allen",
"Juego Llaves Torx","Juego de dados","Jumper","Kit cableado estructural","Led - Varios","Lima - Varios","Limpia contacto",
"Llave Francesa","Llave Inglesa","Llaves Punta corona","Lux√≥metro Amprobe LM-120","Marco de sierra","Maqueta de dom√≥tica - Schneider",
"Maqueta de dom√≥tica - Varios","Martillo","Mazo de goma","Medidor de Aislaci√≥n Megabras MI1050e","Medidor de Aislaci√≥n AEMC",
"Medidor de factor de potencia PCE-PCM","Medidor El√©ctrico","Medidor de Aislaci√≥n Hioki IR4056-20","M√≥dulos LAB VOLT",
"Motor 12v DC","Motor 24v DC","Multimetro Anal√≥gico","Multimetro digital","Nock Out Hidr√°ulico","Nivel","Osciloscopio Digital",
"Osciloscopio Digital de mano","Parada de Emergencia","Pasta de soldar","Pesa","Pelacables","PG - Siemens","Pila AA","Pila AAA",
"Pistola de calor","Probador de fase","Protoboard","Punta taladro PH2","Remachadora POP","Rel√© - Varios","Resistencias - Varios",
"Robot m√≥vil York","Rollo cable de RED cat6","Serrucho","Set EPP","Sensores - Varios","Sonda Osciloscopio","Soplete",
"Tac√≥metro Amprobe Tach-20","Tarjeta de adquisici√≥n de datos MyDAQ","Taladro Inal√°mbrico","Termocupla - Varios",
"Transductor de presi√≥n Danfos MBS1700","Transistores - Varios","Terminales - Varios","Transformador de 12v",
"Transformador de 9v","Esta√±o","Fusibles - tipo Hilo","Fusibles - Varios","Teslameter Tunkia TD8620","Telur√≥metro Megbras MTD - 20KWr",
"Telur√≥metro Megger DET4TCR2","Wattmetro Fluke 345"
];

/* üåü LISTA DE ASIGNATURAS */
const asignaturasLista = [
"Algoritmos y Programaci√≥n Avanzada",
"An√°lisis de Circuitos El√©ctricos",
"An√°lisis de Fallas en Sistemas Mecatr√≥nicos",
"Aplicaciones de Electromagnetismo",
"Arquitectura de Comunicaciones Industriales",
"Automatizaci√≥n Industrial",
"Control con Inteligencia Artificial",
"Control de Fluidos Industriales",
"Control de Sistemas Electroneum√°ticos",
"Conversi√≥n Electromec√°nica de la Energ√≠a",
"Dise√±o Asistido por Computador",
"Dise√±o de Proyectos El√©ctricos en Baja Tensi√≥n",
"Dise√±o de Proyectos El√©ctricos en Media y Alta Tensi√≥n",
"Electricidad Aplicada a la Automatizaci√≥n",
"Electr√≥nica Anal√≥gica y Digital",
"Electr√≥nica de Potencia y Accionamientos",
"Electr√≥nica de Potencia y Microredes",
"Electr√≥nica Programable e Instrumentaci√≥n",
"Energ√≠as Renovables No Convencionales",
"Energ√≠as Renovables y Electromovilidad",
"Evaluaci√≥n de Proyectos de Ingenier√≠a El√©ctrica",
"Fundamentos del Mantenimiento para la Automatizaci√≥n",
"Gesti√≥n del Mantenimiento",
"Integraci√≥n de Redes Industriales",
"Instalaciones El√©ctricas en Baja Tensi√≥n",
"Instalaciones El√©ctricas Inteligentes",
"Instrumentaci√≥n Industrial",
"Instrumentaci√≥n Inteligente",
"Inteligencia Artificial Aplicada al Mantenimiento",
"Introducci√≥n a la Automatizaci√≥n y Rob√≥tica",
"M√°quinas El√©ctricas y Accionamientos",
"Mantenimiento de Circuitos El√©ctricos y Electr√≥nicos de Potencia",
"Mantenimiento de Redes de Comunicaci√≥n e Instrumentaci√≥n de Campo",
"Mantenimiento de Sistemas Hidr√°ulicos y Neum√°ticos",
"Mantenimiento de Sistemas Industriales Automatizados",
"Mantenimiento de Sistemas Rob√≥ticos",
"Mantenimiento El√©ctrico-Instrumentista",
"Manufactura Avanzada",
"Mercado, Normativa y Calidad de Suministro",
"Plataforma SCADA",
"Programaci√≥n Avanzada de Controladores",
"Programaci√≥n de Controladores",
"Programaci√≥n de PLC",
"Programaci√≥n Orientada a Industrias Digitales",
"Proyecto de T√≠tulo para la Automatizaci√≥n I",
"Proyecto El√©ctrico Integrado",
"Proyectos de Ingenier√≠a en Sistemas de Energ√≠a El√©ctrica",
"Proyectos El√©ctricos Integrados",
"Protecciones El√©ctricas Avanzadas",
"Protecciones El√©ctricas y Puestas a Tierra",
"Redes El√©ctricas I",
"Redes El√©ctricas II",
"Redes El√©ctricas Inteligentes",
"Redes El√©ctricas y Subestaciones",
"Redes y Subestaciones El√©ctricas I",
"Redes y Subestaciones El√©ctricas II",
"Rob√≥tica Aplicada a Procesos Industriales",
"Rob√≥tica Avanzada",
"Rob√≥tica Industrial",
"Seguridad Industrial y Riesgos El√©ctricos",
"Seguridad y Riesgos Industriales",
"Simulaci√≥n y Control de Procesos Industriales",
"Simulaci√≥n y Dise√±o 3D",
"Sistemas de Almacenamiento de Energ√≠a",
"Sistemas de Control",
"Sistemas de Control Avanzado y Distribuido",
"Sistemas El√©ctricos de Potencia",
"Sistemas El√©ctricos de Potencia I",
"Sistemas El√©ctricos de Potencia II",
"Taller de Instalaci√≥n y Mantenimiento de Sistemas Automatizados",
"Taller de Operaci√≥n y Mantenimiento de Sistemas Automatizados",
"Telecomunicaciones y Conectividad",
"T√©cnicas de Ultrasonido para Mantenimiento"
];


/* üåü FUNCI√ìN GEN√âRICA DE AUTOCOMPLETADO (Actualizada y corregida visualmente) */
function enableAutocomplete(input, listaOpciones) {
    // 1. Busca el contenedor 'autocomplete-wrapper' 
    const wrapper = input.closest('.autocomplete-wrapper');
    if (!wrapper) {
        console.error('El input debe estar dentro de un div con clase .autocomplete-wrapper');
        return;
    }

    // 2. Crear la lista si no existe
    let lista = wrapper.querySelector(".autocomplete-list");
    if (!lista) {
        lista = document.createElement("ul");
        lista.className = "autocomplete-list";
        lista.style.display = 'none'; // Oculta inicialmente
        wrapper.appendChild(lista);
    }

    input.addEventListener("input", () => {
        const val = input.value.toLowerCase();
        lista.innerHTML = '';
        if (!val) {
            lista.style.display = 'none'; 
            return;
        }
        
        const coincidencias = listaOpciones.filter(item => item.toLowerCase().includes(val));
        
        coincidencias.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            
            li.onmousedown = (e) => {
                e.preventDefault(); 
                input.value = item;
                lista.style.display = 'none'; 
                // Si el input est√° en la tabla, no intentar darle foco ya que puede ser molesto.
                if (!input.closest('td')) {
                    input.focus(); 
                }
            };
            lista.appendChild(li);
        });

        lista.style.display = coincidencias.length > 0 ? 'block' : 'none';
    });

    input.addEventListener("blur", () => {
        // Retraso para dar tiempo al onmousedown y que la lista no se cierre al hacer clic
        setTimeout(() => { lista.style.display = 'none'; }, 150);
    });
}


/* ‚ûï A√±adir fila (Actualizada con wrapper) */
function addRow() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td>
            <div class="autocomplete-wrapper">
                <input type="text" placeholder="Ej: Cables de prueba">
            </div>
        </td>
        <td><input type="number" min="1" value="1"></td>`;
    document.getElementById("tbody").appendChild(tr);

    const inputNuevo = tr.querySelector("input[type=text]");
    enableAutocomplete(inputNuevo, materialesLista);
}


/* ‚ûñ Eliminar fila */
function removeRow() {
    const tbody = document.getElementById("tbody");
    if (tbody.rows.length > 1) tbody.deleteRow(tbody.rows.length - 1);
    else alert("Debe haber al menos un material.");
}

/* üì§ Enviar Solicitud (CORREGIDA) */
async function enviar() {
    const btn = document.querySelector(".btnEnviar");
    btn.disabled = true;
    btn.innerText = "Enviando...";

    const docente = document.getElementById("docente").value;
    const asignatura = document.getElementById("asignatura").value.trim();
    const filas = document.querySelectorAll("#tbody tr");
    const materiales = [];

    // 1. OBTENER EL ID DEL USUARIO
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user || !user.id) return finishError("Error de usuario: El ID de usuario no est√° disponible.");
    const userId = user.id; // Asumimos que 'user.id' contiene el ID de la tabla 'usuarios'

    if (!docente) return finishError("Seleccione un docente.");
    if (!asignatura) return finishError("Ingrese la asignatura.");
    // ... (El resto de la validaci√≥n de materiales sigue igual)
    
    filas.forEach(f => {
        const inputMaterial = f.querySelector("input[type=text]");
        const inputCantidad = f.querySelector("input[type=number]");
        
        const nombre = inputMaterial ? inputMaterial.value.trim() : "";
        const cantidad = inputCantidad ? parseInt(inputCantidad.value.trim(), 10) : 0;
        
        if (nombre && cantidad && cantidad > 0) materiales.push({ material: nombre, cantidad });
    });

    if (materiales.length === 0) return finishError("Debe ingresar al menos un material v√°lido.");

    try {
        /* 1Ô∏è‚É£ Insertar solicitud */
        const { data: solicitud, error } = await supabaseClient
            .from("solicitudes")
            .insert([{
                email: user.email,
                docente,
                asignatura,
                fecha_solicitud: new Date().toISOString(),
                estado: "Pendiente",
                
                // üîë ¬°L√çNEA CORREGIDA Y CLAVE!
                id_usuario: userId 
            }])
            .select()
            .single();

        if (error) throw error;

        /* 2Ô∏è‚É£ Insertar materiales */
        // ... (El resto del c√≥digo de inserci√≥n de materiales sigue igual)
        for (const m of materiales) {
            const { error: materialError } = await supabaseClient
                .from("materiales_solicitados")
                .insert([{ id_solicitud: solicitud.id, material: m.material, cantidad: m.cantidad }]);
            if (materialError) throw materialError;
        }

        alert("‚úÖ Solicitud enviada con √©xito.");
        window.location.href = "menu.html";

    } catch (err) {
        console.error(err);
        finishError("Error al enviar: " + err.message);
    }
}
function finishError(msg) {
    alert("‚ùå " + msg);
    const btn = document.querySelector(".btnEnviar");
    btn.disabled = false;
    btn.innerText = "Enviar Solicitud";
}

/* -------------------------------------------------------------------
    CARGAR DATOS CUANDO VIENE DESDE "REPETIR SOLICITUD"
------------------------------------------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    // Activar autocompletado para el campo de asignatura
    const inputAsignatura = document.getElementById("asignatura");
    if (inputAsignatura) {
        enableAutocomplete(inputAsignatura, asignaturasLista);
    }

    // Activar autocompletado en todos los inputs de material existentes
    document.querySelectorAll("#tbody input[type=text]").forEach(input => {
        enableAutocomplete(input, materialesLista);
    });

    // Cargar datos si viene desde "Repetir Solicitud"
    const params = new URLSearchParams(window.location.search);
    const docente = params.get("docente");
    const asignatura = params.get("asignatura");
    const materiales = JSON.parse(params.get("materiales") || "[]");
    const cantidades = JSON.parse(params.get("cantidades") || "[]");

    if (docente) document.getElementById("docente").value = docente;
    if (asignatura) document.getElementById("asignatura").value = asignatura;

    const tbody = document.getElementById("tbody");
    if (materiales.length > 0) {
        tbody.innerHTML = "";
        for (let i = 0; i < materiales.length; i++) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>
                    <div class="autocomplete-wrapper">
                        <input type="text" value="${materiales[i]}" />
                    </div>
                </td>
                <td><input type="number" min="1" value="${cantidades[i] || 1}" /></td>
            `;
            tbody.appendChild(tr);
            
            // Activar autocompletado para cada input de material cargado
            const inputMaterial = tr.querySelector("input[type=text]");
            enableAutocomplete(inputMaterial, materialesLista);
        }
    }
});
</script>

</body>
</html>

</body>
</html>
